# Hooks + TS æ­å»ºä¸€ä¸ªä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼ˆå…­ï¼‰-- çœ‹æ¿é¡µé¢å±•ç¤º

![hook-ts-jira-6](https://ljcimg.oss-cn-beijing.aliyuncs.com/img/hook-ts-jira-6.png)

> ğŸ“¢ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°ä¸åŒå­¦ï¼Œä¸€å**å¤§äºŒçš„å‰ç«¯çˆ±å¥½è€…**
>
> ğŸ“¢ è¿™ä¸ªç³»åˆ—æ–‡ç« æ˜¯å®æˆ˜ jira ä»»åŠ¡ç®¡ç†ç³»ç»Ÿçš„ä¸€ä¸ªå­¦ä¹ æ€»ç»“
>
> ğŸ“¢ éå¸¸æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œä¸å¯¹çš„åœ°æ–¹æ¬¢è¿æŒ‡æ­£ ğŸ™
>
> ğŸ“¢ **æ„¿ä½ å¿ äºè‡ªå·±ï¼Œçƒ­çˆ±ç”Ÿæ´»**

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†è·¯ç”±çš„è·³è½¬ï¼Œå®ç°äº†å¯¹åº”é¡¹ç›®è·³è½¬åˆ°æ˜¾ç¤ºå¯¹åº”å†…å®¹çš„çœ‹æ¿é¡µé¢ï¼Œåœ¨è¿™å½“ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™äº† `useDocumentTitle` ã€`useDebounce` è¿™ä¸¤ä¸ªç»™ `custom hook` ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ¥å¤„ç†çœ‹æ¿éƒ¨åˆ†çš„å±•ç¤º

## ğŸ’¡ çŸ¥è¯†ç‚¹æŠ¢å…ˆçœ‹

- å°è£… `KanbanColumn`  æ¥å¸ƒå±€é¡µé¢
- ç¼–å†™å¤§é‡çš„ `custom hook` æ¥å¤„ç†çœ‹æ¿æ•°æ®
- å¯¹ `useQuery` æœ‰è¿›ä¸€æ­¥çš„äº†è§£
- åˆ©ç”¨ `filter` å®ç°æ•°æ®çš„ç»Ÿä¸€æ€§

![jira-project-kanban-show](https://ljcimg.oss-cn-beijing.aliyuncs.com/img/jira-project-kanban-show.gif)

## ä¸€ã€å¤„ç†çœ‹æ¿æ•°æ®çš„ custom hook

åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å…ˆè§£å†³ä»¥ä¸‹**è·å–çœ‹æ¿æ•°æ®**çš„é—®é¢˜ï¼Œæœ‰äº†æ•°æ®æˆ‘ä»¬æ‰èƒ½æ›´å¥½çš„é©±åŠ¨è§†å›¾

æˆ‘ä»¬å°†è¿™äº› `hook` å•ç‹¬å†™åœ¨ä¸€ä¸ª `kanban.ts` å†™åœ¨ `util` æ–‡ä»¶å¤¹å†…ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ä¸­çš„ `hook` éƒ½æ˜¯ä¸€äº›**å¤ç”¨æ€§é«˜çš„ï¼Œå’Œé¡µé¢å…³ç³»ä¸å¤§**çš„ `hook` 

### 1. useKanbans

è¿™é‡Œè·å–æ•°æ®çš„æ–¹æ³•å’Œå‰é¢è·å–é¡¹ç›®æ•°æ®çš„æ–¹æ³•ä¸€æ ·ï¼Œæˆ‘ä»¬é‡‡ç”¨ `useQuery` æ¥è¿›è¡Œç¼“å­˜çœ‹æ¿æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ¥æ”¶ä¸€ä¸ª `param` ä½œä¸ºå‚æ•°ï¼Œä¼ é€’å½“å‰çš„ `projectId` å³å¯ï¼Œå½“è¿™ä¸ª `id` å˜åŒ–æ—¶ï¼Œè¡¨ç¤ºåˆ‡æ¢äº†å…¶ä»–é¡¹ç›®çš„çœ‹æ¿ï¼Œæˆ‘ä»¬éœ€è¦**é‡æ–°è¯·æ±‚ä»¥ä¸‹** 

```tsx
export const useKanbans = (param?: Partial<Kanban>) => {
    // é‡‡ç”¨ useHttp æ¥å°è£…è¯·æ±‚
    const client = useHttp()
    // æ˜ å°„ä¸€ä¸ª åä¸º kanbans çš„ç¼“å­˜æ•°æ®ï¼Œå½“ param å˜åŒ–æ—¶ï¼Œé‡æ–°å‘é€è¯·æ±‚ï¼Œå†™å…¥ç¼“å­˜
    return useQuery<Kanban[]>(['kanbans', param], () => client('kanbans', { data: param }))
}
```

å°è£…å¥½äº† `usekanbans` ,æˆ‘ä»¬å·²ç»èƒ½å¤Ÿè·å–é¡¹ç›®ä¸­çš„çœ‹æ¿æ•°æ®äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨å°è£…ä¸€ä¸ª `custom hook` æ¥è·å– `projectId` ï¼Œä»¥å®ç° `useKanBans` çš„ç”¨å¤„

### 2. useProjectIdInUrl

æˆ‘ä»¬åœ¨ `kanban` æ–‡ä»¶å¤¹ï¼Œä¸‹çš„ `util` ä¸­ç¼–å†™è¿™æ®µä»£ç ï¼Œå› ä¸ºå®ƒå’Œé¡¹ç›®æœ‰ç€ç›´æ¥çš„å…³ç³»

é¦–å…ˆåœ¨æˆ‘ä»¬ä¹‹å‰çš„è·¯ç”±å¤„ç†ä¸­ï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬çš„ `projectId` æ˜ å°„åˆ°äº† `url` ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡**è§£æè¿™ä¸ª `url` åœ°å€æ¥å¾—åˆ°å½“å‰é¡µé¢è¯·æ±‚çš„é¡¹ç›® `id`**

è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ `react-router` ä¸­çš„ `hook` æ¥å¾—åˆ° `pathname`ï¼Œå®ƒçš„æ ¼å¼æ˜¯è¿™æ ·çš„ `/projects/1/kanban`

å› æ­¤æˆ‘ä»¬é€šè¿‡**æ­£åˆ™è¡¨è¾¾å¼**æ¥è·å–å‡ºå½“ä¸­çš„æ•°å­—ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ `proejctId` ï¼Œæœ€åè¿”å›è¿™ä¸ª `id` çš„æ•°å­—ç±»å‹å³å¯

```tsx
export const useProjectIdInUrl = () => {
    const { pathname } = useLocation()
    // è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„
    const id = pathname.match(/projects\/(\d+)/)?.[1]
    return Number(id)
}
```

### 3. useProjectInUrl

æœ‰äº†æˆ‘ä»¬çš„ `projectId` ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨é€šè¿‡å®ƒæ¥è·å–æˆ‘ä»¬çš„é¡¹ç›®æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½è·å–åˆ°æˆ‘ä»¬çš„**é¡¹ç›®çš„åç§°**ï¼Œæ˜¾ç¤ºåˆ°é¡µé¢ä¸Š

```tsx
// é€šè¿‡ id è·å–é¡¹ç›®ä¿¡æ¯
export const useProjectInUrl = () => useProject(useProjectIdInUrl())
```

ä½¿ç”¨ 

```tsx
const { data: currentProject } = useProjectInUrl()
<h1>{currentProject?.name}çœ‹æ¿</h1>
```

å†™åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿè·å–åˆ°çœ‹æ¿æ•°æ®ä»¥åŠé¡¹ç›®ä¿¡æ¯äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ¥è·å–å¯¹åº”çš„ä»»åŠ¡ä¿¡æ¯

### 4. useKanbanSearchParams

ä¸ºäº†é¿å…æˆ‘ä»¬è·å–åˆ°çš„çœ‹æ¿æ•°æ®æ˜¯å…¨éƒ¨é¡¹ç›®ä¸­çš„çœ‹æ¿æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å°† `id` è½¬ä¸º `key-value` ä¼ é€’ç»™ `useKanbans` æ¥è·å–æ•°æ®

```tsx
export const useKanbanSearchParams = () => ({ projectId: useProjectIdInUrl() })
```

### 5. useTasks

æ¥ç€æˆ‘ä»¬éœ€è¦æ¥è·å– `task` æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®çš„**ä»»åŠ¡æ•°æ®**

å’Œè·å– `kanban` æ•°æ®ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦é‡‡ç”¨ `useQuery` æ¥å¤„ç†

```tsx
export const useTasks = (param?: Partial<Task>) => {
    const client = useHttp()
    // æœç´¢æ¡†è¯·æ±‚åœ¨è¿™é‡Œè§¦å‘
    return useQuery<Task[]>(['tasks', param], () => client('tasks', { data: param }))
}
```

åœ¨è¿™é‡Œå°±è®²è®²ç±»å‹å§~

åœ¨è¿™é‡Œæˆ‘ä»¬æ¥æ”¶ä¸€ä¸ªå¯é€‰çš„å‚æ•°ï¼Œ`Task` ï¼Œ`Task` æ˜¯æˆ‘ä»¬å°è£…åœ¨ `types` ä¸­çš„ä¸€ä¸ª**å…±äº«æ¥å£**

````tsx
export interface Task {
    id: number;
    name: string;
    // ç»åŠäºº
    processorId: number;
    projectId: number;
    // ä»»åŠ¡ç»„
    epicId: number;
    kanbanId: number;
    // bug or task
    typeId: number;
    note: string;
}
````

è¿™é‡Œå®šä¹‰çš„éƒ½æ˜¯åç«¯**è¿”å›çš„æ•°æ®ç±»å‹**

 `Partial` çš„ä½œç”¨æ˜¯ï¼Œè®©æ¥å£ä¸­çš„å˜é‡éƒ½å˜æˆ**å¯é€‰çš„**

è¿™æ ·æˆ‘ä»¬å°±ä¹Ÿå®ç°äº†å¯¹çœ‹æ¿ä¸­çš„ `task` è·å–ï¼Œæ¥ä¸‹æ¥åŒæ ·çš„æˆ‘ä»¬éœ€è¦å®ç°è·å–å¯¹åº”çœ‹æ¿ä¸­çš„ `task`

### 6. useTasksSearchParams

ä¸ºäº†è®©æˆ‘ä»¬è·å–åˆ°çš„ä»»åŠ¡æ•°æ®æ¥è‡ªäºå½“å‰çš„çœ‹æ¿æˆ‘ä»¬ä¹Ÿéœ€è¦å°è£…ä¸€ä¸ª `searchParams` æ¥è·å–ç›¸åº”é¡¹ç›®ä¸‹çš„çœ‹æ¿ä¿¡æ¯

```tsx
export const useTaskSearchParams = () => ({ projectId: useProjectIdInUrl() })
```

åœ¨ä¹‹åï¼Œæˆ‘ä»¬ä¼šå¯¹è¿™ä¸ª `hook` è¿›è¡Œæ”¹é€ 

## äºŒã€å°è£… KanbanColumn æ¸²æŸ“é¡µé¢

### 1. çœ‹æ¿å’Œä»»åŠ¡æ•°æ®ç»Ÿä¸€

æ˜ç¡®æˆ‘ä»¬è¿™ä¸ªç»„ä»¶çš„ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å®ƒæ¥æ¸²æŸ“æ¯ä¸€åˆ—çš„çœ‹æ¿

![image-20211010135726728](https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20211010135726728.png)



å¤§æ¦‚æ˜¯è¿™æ ·ä¸€ä¸ªå¸ƒå±€ï¼Œé¦–å…ˆï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å°†**ä»»åŠ¡æ¸²æŸ“åˆ°å¯¹åº”çš„çœ‹æ¿åˆ—è¡¨**ä¸‹ï¼Œå› æ­¤é¦–å…ˆæˆ‘ä»¬éœ€è¦è§£å†³æ•°æ®çš„é—®é¢˜

æˆ‘ä»¬åœ¨ `KanbanColumn` ä¸­è·å–æ•°æ®ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦ååˆ†æ˜ç¡®ï¼Œè¿™ä¸ªæˆ‘ä»¬çš„è¿™ä¸ªç»„ä»¶å®ƒ**åªæ˜¯æ¸²æŸ“ä¸€åˆ—**ï¼Œæˆ‘ä»¬é€šè¿‡éå†å®ç°å¤šåˆ—ï¼Œè¿™ä¸ªå¾ˆå…³é”®

æˆ‘ä»¬åœ¨ `column` ä¸­è·å–æ‰€æœ‰çš„ `task` æ•°æ®ï¼Œ**é€šè¿‡ `filter` æ–¹æ³•ï¼Œå°†å®ƒç­›é€‰å‡ºæ¥**ï¼Œè¿™æ ·ï¼Œæœ€åå¾—åˆ°çš„å°±æ˜¯å’Œ `kanbanId` åŒ¹é…çš„ `task` æ•°æ®

```tsx
const { data: allTasks } = useTasks(useTasksSearchParams())
// å¯¹æ•°æ®è¿›è¡Œåˆ†ç±»ï¼Œè¿”å›çš„æ˜¯ä¸‰æ®µæ•°æ®ï¼Œéƒ½æ˜¯æ•°ç»„
const tasks = allTasks?.filter(task => task.kanbanId === kanban.id)
```

**åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜**

æˆ‘ä»¬ä¸ªæ¯ä¸€ä¸ª `column` éƒ½ç»‘å®šäº†ä¸€ä¸ª `useTasks` ï¼ŒæŒ‰ç†è¯´å®ƒåº”è¯¥ä¼šå‘é€**å¤šæ¬¡çš„è¯·æ±‚** ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹åˆ°åº•æ˜¯ä¸æ˜¯è¿™æ ·

![image-20211010140655996](https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20211010140655996.png)

åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°å®ƒä¸€å…±å‘é€äº† 2æ¬¡è¯·æ±‚ï¼Œä½†æ˜¯æˆ‘å¯åŠ¨çš„è¿™ä¸ªçœ‹æ¿ä¸­æœ‰ä¸‰ä¸ª `column`

ä¸å¦¨æˆ‘ä»¬å†å¤šæ·»åŠ å‡ ä¸ª `column` ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹

![image-20211010140908606](https://ljcimg.oss-cn-beijing.aliyuncs.com/img/image-20211010140908606.png)

åœ¨è¿™é‡Œå§‹ç»ˆéƒ½æ˜¯åªæœ‰2ä¸ªè¯·æ±‚ï¼Œé‚£è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å…¶å®åœ¨æˆ‘ä»¬åœ¨éå†æ·»åŠ  `kanbanColumns` ç»„ä»¶æ—¶ï¼Œåªä¼šå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œå³ä½¿ï¼Œæˆ‘ä»¬ç»™æ¯ä¸€ä¸ª `column` éƒ½ç»‘å®šäº† `useTask` 

è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬é‡‡ç”¨çš„ `react-query` çš„åŠŸåŠ³ï¼Œåœ¨æˆ‘ä»¬é‡‡ç”¨ `useQuery` æ—¶ï¼Œ**å¦‚æœåœ¨ 2s ä¹‹å†…æœ‰ç›¸åŒçš„ `queryKey` å‘å‡ºè¯·æ±‚çš„è¯ï¼Œå°±ä¼šåˆå¹¶è¿™äº›è¯·æ±‚ï¼Œåªä¼šå‘å‡ºä¸€ä¸ª**

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†æ¯ä¸ªçœ‹æ¿ä¸‹çš„ `Task` æ•°æ®äº†ï¼Œæˆ‘ä»¬åªéœ€è¦éå†æ¸²æŸ“å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨çš„è¿˜æ˜¯ `Antd` ç»„ä»¶åº“

### 2. useTaskTypes å¤„ç†ä¸åŒç±»å‹ä»»åŠ¡çš„ icon

åœ¨æˆ‘ä»¬çš„ä»»åŠ¡ä¸­åˆåˆ†ä¸º `bug` å’Œ `task`ï¼Œæˆ‘ä»¬éƒ½ä¼šæœ‰ç›¸åº”çš„å›¾æ ‡å±•ç¤º

åœ¨è¿™é‡Œæˆ‘ä»¬åœ¨ `utils` ä¸‹å°è£…ä¸€ä¸ª `useTaskTypes` æ¥è·å– `task` çš„ç±»å‹

```tsx
export const useTaskTypes = () => {
    const client = useHttp()
    // è·å–æ‰€æœ‰çš„task type
    return useQuery<TaskType[]>(['taskTypes'], () => client('taskTypes'))
}
```

åœ¨è¿™é‡Œæˆ‘ä»¬å°è£…ä¸€ä¸ª `TaskTypeIcon` å°ç»„ä»¶ï¼Œæ¥è¿”å›ç±»å‹å¯¹åº”çš„ `icon` ï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦æ¥æ”¶ä¸€ä¸ª `taskid` ä½œä¸ºå‚æ•°ï¼Œç”¨æ¥**åˆ¤æ–­è¿™ä¸ªä»»åŠ¡æ˜¯ä»€ä¹ˆç±»å‹**

```tsx
// é€šè¿‡typeæ¸²æŸ“å›¾ç‰‡
const TaskTypeIcon = ({ id }: { id: number }) => {
    const { data: taskTypes } = useTaskTypes()
    const name = taskTypes?.find(taskType => taskType.id === id)?.name;
    if (!name) {
        return null
    }
    return <img alt={'task-icon'} src={name === 'task' ? taskIcon : bugIcon} />
}
```

## ä¸‰ã€å¤„ç†ä»»åŠ¡çš„æœç´¢åŠŸèƒ½

### 1. useTasksSearchParams

åœ¨æˆ‘ä»¬å‰é¢å·²ç»æœ‰ç”¨åˆ°è¿™ä¸ª `hook` äº†ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº›ä»£ç ï¼Œæ¥å®ç°**æœç´¢æ¡†çš„é€»è¾‘**ï¼Œåœ¨ä¹‹å‰æˆ‘ä»¬é€šè¿‡è¿™ä¸ªæ¥è¿”å›ç”¨æˆ· `id` çš„å¯¹è±¡ï¼Œè¿™ä¸ªåŠŸèƒ½ä¹Ÿä¸èƒ½é—å¿˜å™¢~

```tsx
export const useTasksSearchParams = () => {
    // æœç´¢å†…å®¹
    const [param] = useUrlQueryParam([
        'name',
        'typeId',
        'processorId',
        'tagId'
    ])
    // è·å–å½“å‰çš„é¡¹ç›®idç”¨æ¥è·å–çœ‹æ¿æ•°æ®
    const projectId = useProjectIdInUrl()
    // è¿”å›çš„æ•°ç»„ï¼Œå¹¶ç›‘å¬ paramå˜åŒ–
    return useMemo(() => ({
        projectId,
        typeId: Number(param.typeId) || undefined,
        processId: Number(param.processorId) || undefined,
        tagId: Number(param.tagId) || undefined,
        name: param.name
    }), [projectId, param])
}
```

åœ¨è¿™é‡Œæˆ‘ä»¬å°è£…çš„è¿™ä¸ªæ–¹æ³•ï¼Œç”¨äºè¿”å›æœ€å°çš„ `task` åˆ—è¡¨æ•°æ®ï¼Œè¿™é‡Œéœ€è¦å®ç°çš„æœç´¢åŠŸèƒ½åœ¨å‰é¢çš„é¡¹ç›®æœç´¢æ¡†ä¹Ÿå®ç°è¿‡äº†ï¼Œé‡‡ç”¨ `useSetUrlSearchParam` æ¥ä¿®æ”¹å½“å‰çš„ `url` åœ°å€ï¼Œæ¥é€ æˆæ•°æ®çš„å˜åŒ–ï¼Œåˆç”±äºï¼Œæˆ‘ä»¬è¿™ä¸ª `hook` è¿”å›çš„æ•°æ®ä¸­çš„ä¾èµ–é¡¹å‘ç”Ÿæ”¹å˜ï¼Œé€ æˆäº†æ˜¾ç¤ºå†…å®¹çš„æ”¹å˜ï¼Œä»è€Œè¾¾åˆ°æœç´¢æ•ˆæœ

### 2. é‡ç½®æŒ‰é’®

åœ¨è¿™é‡Œå‹‡ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„æŒ‰é’®ï¼Œæ¸…æ¥šç­›é€‰å™¨ï¼Œå®ƒå®ç°çš„æ–¹æ³•è¯·æ±‚éå¸¸çš„ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ‰€æœ‰çš„æ•°æ®é‡ç½®ä¸º `undefined` ï¼Œæˆ‘ä»¬çš„ `clean` å‡½æ•°ï¼Œå°±ä¼šè®² `query` **ä¿®ç†ä¸ºç©ºï¼Œè¿™æ ·æˆ‘ä»¬è¿”å›çš„æ•°æ®å°±ä¼šæ˜¯å…¨éƒ¨çš„æ•°æ®**

```tsx
const reset = () => {
    setSearchParams({
        typeId: undefined,
        processId: undefined,
        tagId: undefined,
        name: undefined
    })
}
```

## å››ã€çœ‹æ¿çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½

è¿™éƒ¨åˆ†çš„å†…å®¹å’Œä¹‹å‰çš„é¡¹ç›®åˆ—è¡¨ç›¸ä¼¼åº¦å¾ˆé«˜ï¼Œæˆ‘ä»¬è¿™é‡Œå°±ä¸è¯¦ç»†è®²äº†ï¼Œç¨å¾®è§£é‡Šä»¥ä¸‹è¿™äº› `hook` çš„ä½œç”¨

### 1. useAddKanban

æ¥ç€æˆ‘ä»¬éœ€è¦å¤„ç†çœ‹æ¿å¢åˆ çš„ `hook` ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æœ‰å¿…è¦é‡‡ç”¨ä¹è§‚æ›´æ–°æ¥å®ç°ï¼Œä¸ç„¶åœ¨æœåŠ¡å™¨è¯·æ±‚æ…¢æ—¶ï¼Œé€ æˆé¡µé¢å‡æ­»è¿‡é•¿

å’Œå‰é¢ä¸€æ ·ï¼Œæˆ‘ä»¬é‡‡ç”¨ `useMutation` æ¥å°è£… `http` è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªè¢«å¤„ç†è¿‡çš„ `mutate` è¯·æ±‚æ–¹å¼æˆ–è€… `mutateAsync` å¼‚æ­¥è¯·æ±‚æ–¹å¼

åœ¨è¿™é‡Œæˆ‘ä»¬æ¥æ”¶äº†ä¸€ä¸ª `queryKey` ä½œä¸ºå‚æ•°ï¼Œè¿™é‡Œå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„**ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç¼“å­˜ä¸­çš„æ•°æ®åç§°**ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯å®ƒçš„é‡æ–°åˆ·æ–°çš„ä¾èµ–

```tsx
export const useAddKanban = (queryKey: QueryKey) => {
    const client = useHttp()
    // å¤„ç† http è¯·æ±‚
    return useMutation(
        (params: Partial<Kanban>) => client(`kanbans`, {
            method: "POST",
            data: params
        }),
        // é…ç½®ä¹è§‚æ›´æ–°
        useAddConfig(queryKey)
    )
}
```

åœ¨ `config` é…ç½®ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ `old` å…ƒç´ ä¸­ï¼Œé€šè¿‡æ•°ç»„è§£æ„çš„æ–¹å¼ï¼Œå°†æ–°æ•°æ®æ·»åŠ åˆ°äº†ç¼“å­˜ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®ç°äº†å¯¹æ•°æ®çš„æ›´æ”¹

```tsx
export const useAddConfig = (queryKey: QueryKey) => useConfig(queryKey, (target, old) => old ? [...old, target] : [])
```

### 2. useDeleteKanban

**åˆ é™¤çœ‹æ¿**çš„ `hook` ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œé‡‡ç”¨çš„ `config` ä¹Ÿæ˜¯æˆ‘ä»¬ä¹‹å‰å°±å°è£…è¿‡çš„ï¼Œå¯¹äºæ‰€æœ‰çš„å¢åˆ æ”¹éƒ½æˆç«‹çš„ `hook` 

```tsx
// åˆ é™¤çœ‹æ¿
export const useDeleteKanban = (queryKey: QueryKey) => {
    const client = useHttp()
    return useMutation(
        ({ id }: { id: number }) => client(`kanbans/${id}`, {
            method: "DELETE",
        }),
        useDeleteConfig(queryKey)
    )
}
```

åœ¨è¿™é‡Œæ¥æ”¶çš„å‚æ•°åªæœ‰  `id` ï¼Œåˆ é™¤çœ‹æ¿çš„ `id`

## äº”ã€ä»»åŠ¡çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½

å¢åˆ æ”¹æŸ¥çš„åŠŸèƒ½éƒ½å·®ä¸å¤šï¼Œåªæ˜¯ä¼ é€’çš„å‚æ•°ä¸ä¸€æ ·ç½¢äº†ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±æ‹¿ä¸€ä¸ªç¼–è¾‘åŠŸèƒ½æ¥è®²

æˆ‘ä»¬é¦–å…ˆå°è£…äº†ä¸€ä¸ªæ§åˆ¶ `modal` å¼€å…³çš„ `hook` `useTasksModel` 

```tsx
const [form] = useForm()
const { editingTaskId, editingTask, close } = useTasksModel()
// è§£æ„ä¸€ä¸ª task æ–¹æ³•
const { mutateAsync: editTask, isLoading: editLoading } = useEditTask(useTasksQueryKey())
// æ·»åŠ ä¸€ä¸ªåˆ é™¤ä»»åŠ¡çš„æ–¹æ³•
const { mutateAsync: deleteTask } = useDeleteTask(useTasksQueryKey())
// ç‚¹å‡»å–æ¶ˆæ—¶ï¼Œè°ƒç”¨closeåŒæ—¶æ¸…ç©ºè¡¨å•
```

åœ¨è¿™é‡Œæˆ‘ä»¬æš´éœ²å‡ºäº†å¾ˆå¤šå…³äºä»»åŠ¡å¢åˆ æ”¹æŸ¥çš„æ–¹æ³•ï¼Œåªè¦è°ƒç”¨å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨ `modal` ä¸­ï¼Œç»‘å®šäº† `onOk` ä»¥åŠ `onCancel` æ–¹æ³•

è¿™é‡Œæœ‰ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹

æˆ‘ä»¬è¿™æ¬¡é‡‡ç”¨çš„æ˜¯ `mutateAsync` å¼‚æ­¥æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é‡‡ç”¨ `await` è¿›è¡Œç­‰å¾…æ‰§è¡Œç»“æœ

```tsx
const onCancel = () => {
    close()
    form.resetFields()
}
const onOk = async () => {
    // è·å–è¡¨å•æ•°æ®
    await editTask({ ...editingTask, ...form.getFieldsValue() })
    // å…³é—­è¡¨å•
    close()
}
```

----

## ğŸ“Œ æ€»ç»“

åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬åšå®Œäº†çœ‹æ¿é¡µé¢çš„åˆ¶ä½œï¼Œæˆ‘ä»¬èƒ½å­¦åˆ°è¿™äº›ä¸œè¥¿

1. ç†Ÿæ‚‰äº†å¢åˆ æ”¹æŸ¥çš„æ“ä½œ
2. äº†è§£äº† `useQuery` çš„ç”¨æ³•
3. å¯¹ `modal` ç»„ä»¶æœ‰äº†æ›´å¤šçš„äº†è§£
4. äº†è§£äº† `react-query` èƒ½å¤Ÿä¼˜åŒ–è¯·æ±‚æ¬¡æ•°

> æœ€åï¼Œå¯èƒ½åœ¨å¾ˆå¤šåœ°æ–¹è®²è¯‰çš„ä¸å¤Ÿæ¸…æ™°ï¼Œè¯·è§è°…
>
> ğŸ’Œ å¦‚æœæ–‡ç« æœ‰ä»€ä¹ˆé”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆç–‘é—®ï¼Œæ¬¢è¿ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿ç§ä¿¡äº¤æµ

